<html>
<head>
  <title>collections</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2070"/>
<h1>collections</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/9/3 21:21</i></td></tr>
</table>
</div>
<br/>

<div><span>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="font:14px/20px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-size-adjust:100%;background:rgb(255, 255, 255);color:rgb(68, 68, 68);"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;color:rgb(102, 102, 102);background-color:rgb(255, 255, 255);"><div><div style="box-sizing:border-box;"><div style="list-style:none;"><div style="box-sizing:border-box;"><div><div><div>
								    <h4 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;font-size:16px;line-height:22px;">collections</h4>
    <div>
    	<span>阅读: 617563</span>
    	</div>

    <hr style="box-sizing:content-box;height:0px;margin:15px 0px;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);"/>

    <div><p style="margin:0px 0px 15px;">collections是Python内建的一个集合模块，提供了许多有用的集合类。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">namedtuple</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">我们知道<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">tuple</code>可以表示不变集合，例如，一个点的二维坐标就可以表示成：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>p = (<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">2</span>)
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">但是，看到<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">(1, 2)</code>，很难看出这个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">tuple</code>是用来表示一个坐标的。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">定义一个class又小题大做了，这时，<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">namedtuple</code>就派上了用场：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> collections <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> namedtuple
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>Point = namedtuple(<span style="color:rgb(221, 17, 68);">'Point'</span>, [<span style="color:rgb(221, 17, 68);">'x'</span>, <span style="color:rgb(221, 17, 68);">'y'</span>])
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>p = Point(<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">2</span>)
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>p.x
<span style="color:rgb(0, 153, 153);">1</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>p.y
<span style="color:rgb(0, 153, 153);">2</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">namedtuple</code>是一个函数，它用来创建一个自定义的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">tuple</code>对象，并且规定了<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">tuple</code>元素的个数，并可以用属性而不是索引来引用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">tuple</code>的某个元素。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">这样一来，我们用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">namedtuple</code>可以很方便地定义一种数据类型，它具备tuple的不变性，又可以根据属性来引用，使用十分方便。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">可以验证创建的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Point</code>对象是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">tuple</code>的一种子类：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>isinstance(p, Point)
<span style="color:rgb(0, 134, 179);">True</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>isinstance(p, tuple)
<span style="color:rgb(0, 134, 179);">True</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">类似的，如果要用坐标和半径表示一个圆，也可以用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">namedtuple</code>定义：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 153, 136);font-style:italic;"># namedtuple('名称', [属性list]):</span>
<span style="color:rgb(0, 153, 153);">Circle</span> = namedtuple(<span style="color:rgb(221, 17, 68);">'Circle'</span>, [<span style="color:rgb(221, 17, 68);">'x'</span>, <span style="color:rgb(221, 17, 68);">'y'</span>, <span style="color:rgb(221, 17, 68);">'r'</span>])
</code></pre>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">deque</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">使用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">list</code>存储数据时，按索引访问元素很快，但是插入和删除元素就很慢了，因为<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">list</code>是线性存储，数据量大的时候，插入和删除效率很低。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">deque是为了高效实现插入和删除操作的双向列表，适合用于队列和栈：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> collections <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> deque
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>q = deque([<span style="color:rgb(221, 17, 68);">'a'</span>, <span style="color:rgb(221, 17, 68);">'b'</span>, <span style="color:rgb(221, 17, 68);">'c'</span>])
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>q.append(<span style="color:rgb(221, 17, 68);">'x'</span>)
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>q.appendleft(<span style="color:rgb(221, 17, 68);">'y'</span>)
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>q
deque([<span style="color:rgb(221, 17, 68);">'y'</span>, <span style="color:rgb(221, 17, 68);">'a'</span>, <span style="color:rgb(221, 17, 68);">'b'</span>, <span style="color:rgb(221, 17, 68);">'c'</span>, <span style="color:rgb(221, 17, 68);">'x'</span>])
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">deque</code>除了实现list的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">append()</code>和<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">pop()</code>外，还支持<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">appendleft()</code>和<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">popleft()</code>，这样就可以非常高效地往头部添加或删除元素。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">defaultdict</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">使用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>时，如果引用的Key不存在，就会抛出<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">KeyError</code>。如果希望key不存在时，返回一个默认值，就可以用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">defaultdict</code>：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> collections <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> defaultdict
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>dd = defaultdict(<span style="color:rgb(51, 51, 51);font-weight:bold;">lambda</span>: <span style="color:rgb(221, 17, 68);">'N/A'</span>)
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>dd[<span style="color:rgb(221, 17, 68);">'key1'</span>] = <span style="color:rgb(221, 17, 68);">'abc'</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>dd[<span style="color:rgb(221, 17, 68);">'key1'</span>] <span style="color:rgb(153, 153, 136);font-style:italic;"># key1存在</span>
<span style="color:rgb(221, 17, 68);">'abc'</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>dd[<span style="color:rgb(221, 17, 68);">'key2'</span>] <span style="color:rgb(153, 153, 136);font-style:italic;"># key2不存在，返回默认值</span>
<span style="color:rgb(221, 17, 68);">'N/A'</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">注意默认值是调用函数返回的，而函数在创建<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">defaultdict</code>对象时传入。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">除了在Key不存在时返回默认值，<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">defaultdict</code>的其他行为跟<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>是完全一样的。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">OrderedDict</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">使用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>时，Key是无序的。在对<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>做迭代时，我们无法确定Key的顺序。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">如果要保持Key的顺序，可以用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">OrderedDict</code>：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> collections <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> OrderedDict
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>d = dict([(<span style="color:rgb(221, 17, 68);">'a'</span>, <span style="color:rgb(0, 153, 153);">1</span>), (<span style="color:rgb(221, 17, 68);">'b'</span>, <span style="color:rgb(0, 153, 153);">2</span>), (<span style="color:rgb(221, 17, 68);">'c'</span>, <span style="color:rgb(0, 153, 153);">3</span>)])
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>d <span style="color:rgb(153, 153, 136);font-style:italic;"># dict的Key是无序的</span>
{<span style="color:rgb(221, 17, 68);">'a'</span>: <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(221, 17, 68);">'c'</span>: <span style="color:rgb(0, 153, 153);">3</span>, <span style="color:rgb(221, 17, 68);">'b'</span>: <span style="color:rgb(0, 153, 153);">2</span>}
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>od = OrderedDict([(<span style="color:rgb(221, 17, 68);">'a'</span>, <span style="color:rgb(0, 153, 153);">1</span>), (<span style="color:rgb(221, 17, 68);">'b'</span>, <span style="color:rgb(0, 153, 153);">2</span>), (<span style="color:rgb(221, 17, 68);">'c'</span>, <span style="color:rgb(0, 153, 153);">3</span>)])
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>od <span style="color:rgb(153, 153, 136);font-style:italic;"># OrderedDict的Key是有序的</span>
OrderedDict([(<span style="color:rgb(221, 17, 68);">'a'</span>, <span style="color:rgb(0, 153, 153);">1</span>), (<span style="color:rgb(221, 17, 68);">'b'</span>, <span style="color:rgb(0, 153, 153);">2</span>), (<span style="color:rgb(221, 17, 68);">'c'</span>, <span style="color:rgb(0, 153, 153);">3</span>)])
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">注意，<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">OrderedDict</code>的Key会按照插入的顺序排列，不是Key本身排序：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>od = OrderedDict()
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>od[<span style="color:rgb(221, 17, 68);">'z'</span>] = <span style="color:rgb(0, 153, 153);">1</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>od[<span style="color:rgb(221, 17, 68);">'y'</span>] = <span style="color:rgb(0, 153, 153);">2</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>od[<span style="color:rgb(221, 17, 68);">'x'</span>] = <span style="color:rgb(0, 153, 153);">3</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>list(od.keys()) <span style="color:rgb(153, 153, 136);font-style:italic;"># 按照插入的Key的顺序返回</span>
[<span style="color:rgb(221, 17, 68);">'z'</span>, <span style="color:rgb(221, 17, 68);">'y'</span>, <span style="color:rgb(221, 17, 68);">'x'</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">OrderedDict</code>可以实现一个FIFO（先进先出）的dict，当容量超出限制时，先删除最早添加的Key：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> collections <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> OrderedDict

<span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">LastUpdatedOrderedDict</span><span>(OrderedDict)</span>:</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self, capacity)</span>:</span>
        super(LastUpdatedOrderedDict, self).__init__()
        self._capacity = capacity

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__setitem__</span><span>(self, key, value)</span>:</span>
        containsKey = <span style="color:rgb(0, 153, 153);">1</span> <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> key <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> self <span style="color:rgb(51, 51, 51);font-weight:bold;">else</span> <span style="color:rgb(0, 153, 153);">0</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> len(self) - containsKey &gt;= self._capacity:
            last = self.popitem(last=<span style="color:rgb(0, 134, 179);">False</span>)
            print(<span style="color:rgb(221, 17, 68);">'remove:'</span>, last)
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> containsKey:
            <span style="color:rgb(51, 51, 51);font-weight:bold;">del</span> self[key]
            print(<span style="color:rgb(221, 17, 68);">'set:'</span>, (key, value))
        <span style="color:rgb(51, 51, 51);font-weight:bold;">else</span>:
            print(<span style="color:rgb(221, 17, 68);">'add:'</span>, (key, value))
        OrderedDict.__setitem__(self, key, value)
</code></pre>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">ChainMap</h3>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">ChainMap</code>可以把一组<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>串起来并组成一个逻辑上的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>。<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">ChainMap</code>本身也是一个dict，但是查找的时候，会按照顺序在内部的dict依次查找。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">什么时候使用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">ChainMap</code>最合适？举个例子：应用程序往往都需要传入参数，参数可以通过命令行传入，可以通过环境变量传入，还可以有默认参数。我们可以用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">ChainMap</code>实现参数的优先级查找，即先查命令行参数，如果没有传入，再查环境变量，如果没有，就使用默认参数。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">下面的代码演示了如何查找<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">user</code>和<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">color</code>这两个参数：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> collections <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> ChainMap
<span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> os, argparse

<span style="color:rgb(153, 153, 136);font-style:italic;"># 构造缺省参数:</span>
defaults = {
    <span style="color:rgb(221, 17, 68);">'color'</span>: <span style="color:rgb(221, 17, 68);">'red'</span>,
    <span style="color:rgb(221, 17, 68);">'user'</span>: <span style="color:rgb(221, 17, 68);">'guest'</span>
}

<span style="color:rgb(153, 153, 136);font-style:italic;"># 构造命令行参数:</span>
parser = argparse.ArgumentParser()
parser.add_argument(<span style="color:rgb(221, 17, 68);">'-u'</span>, <span style="color:rgb(221, 17, 68);">'--user'</span>)
parser.add_argument(<span style="color:rgb(221, 17, 68);">'-c'</span>, <span style="color:rgb(221, 17, 68);">'--color'</span>)
namespace = parser.parse_args()
command_line_args = { k: v <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> k, v <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> vars(namespace).items() <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> v }

<span style="color:rgb(153, 153, 136);font-style:italic;"># 组合成ChainMap:</span>
combined = ChainMap(command_line_args, os.environ, defaults)

<span style="color:rgb(153, 153, 136);font-style:italic;"># 打印参数:</span>
print(<span style="color:rgb(221, 17, 68);">'color=%s'</span> % combined[<span style="color:rgb(221, 17, 68);">'color'</span>])
print(<span style="color:rgb(221, 17, 68);">'user=%s'</span> % combined[<span style="color:rgb(221, 17, 68);">'user'</span>])
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">没有任何参数时，打印出默认参数：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(0, 128, 128);">$ </span>python3 use_chainmap.py 
color=red
user=guest
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">当传入命令行参数时，优先使用命令行参数：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(0, 128, 128);">$ </span>python3 use_chainmap.py -u bob
color=red
user=bob
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">同时传入命令行参数和环境变量，命令行参数的优先级较高：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(0, 128, 128);">$ </span>user=admin color=green python3 use_chainmap.py -u bob
color=green
user=bob
</code></pre>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">Counter</h3>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Counter</code>是一个简单的计数器，例如，统计字符出现的个数：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> collections <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> Counter
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>c = Counter()
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> ch <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> <span style="color:rgb(221, 17, 68);">'programming'</span>:
<span style="color:rgb(153, 0, 115);">... </span>    c[ch] = c[ch] + <span style="color:rgb(0, 153, 153);">1</span>
...
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>c
Counter({<span style="color:rgb(221, 17, 68);">'g'</span>: <span style="color:rgb(0, 153, 153);">2</span>, <span style="color:rgb(221, 17, 68);">'m'</span>: <span style="color:rgb(0, 153, 153);">2</span>, <span style="color:rgb(221, 17, 68);">'r'</span>: <span style="color:rgb(0, 153, 153);">2</span>, <span style="color:rgb(221, 17, 68);">'a'</span>: <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(221, 17, 68);">'i'</span>: <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(221, 17, 68);">'o'</span>: <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(221, 17, 68);">'n'</span>: <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(221, 17, 68);">'p'</span>: <span style="color:rgb(0, 153, 153);">1</span>})
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Counter</code>实际上也是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>的一个子类，上面的结果可以看出，字符<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">'g'</code>、<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">'m'</code>、<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">'r'</code>各出现了两次，其他字符各出现了一次。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">小结</h3>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">collections</code>模块提供了一些有用的集合类，可以根据需要选用。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">参考源码</h3>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/commonlib/use_collections.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">use_collections.py</a></p>
</div><h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">读后有收获可以支付宝请作者喝咖啡，读后有疑问请加微信群讨论：</h3><p style="margin:0px 0px 15px;margin-top:15px;"><img src="collections_files/0" type="image/png" data-filename="0" height="220" style="vertical-align:middle;max-width:100%;height:auto;box-sizing:border-box;border:0px;" width="220"/> <img src="collections_files/0 [1]" type="image/jpeg" data-filename="0" height="220" style="vertical-align:middle;max-width:100%;height:auto;box-sizing:border-box;border:0px;" width="220"/></p><h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">还可以分享给朋友：</h3><p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017681679479008#0" style="-webkit-appearance:none;margin:0px;overflow:visible;font-style:inherit;font-variant:inherit;font-weight:inherit;font-stretch:inherit;font-family:inherit;text-transform:none;display:inline-block;box-sizing:border-box;padding:0px 12px;vertical-align:middle;line-height:28px;min-height:30px;font-size:14px;text-align:center;border:1px solid rgba(0, 0, 0, 0.06);border-radius:4px;background:rgb(245, 245, 245);text-decoration:none;background-color:rgb(218, 49, 75);color:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 0px 5px inset;text-shadow:rgba(0, 0, 0, 0.1) 0px -1px 0px;cursor:pointer;"><i style="font-family:FontAwesome;display:inline-block;font-weight:normal;font-style:normal;line-height:1;-webkit-font-smoothing:antialiased;text-decoration:none;"><span style="font-family:FontAwesome;font-weight:normal;font-style:normal;line-height:1;"></span></i> 分享到微博</a></p>

    <hr style="box-sizing:content-box;height:0px;margin:15px 0px;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);"/>

    <div style="padding-left:15px;padding-right:15px;"><span style="display:table-cell;"></span><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017648783851616" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;"><i style="font-family:FontAwesome;display:inline-block;font-weight:normal;font-style:normal;line-height:1;-webkit-font-smoothing:antialiased;text-decoration:none;"><span style="font-family:FontAwesome;font-weight:normal;font-style:normal;line-height:1;"></span></i> 上一页</a><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017684507717184" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;float:right;max-width:100%;">下一页 <i style="font-family:FontAwesome;display:inline-block;font-weight:normal;font-style:normal;line-height:1;-webkit-font-smoothing:antialiased;text-decoration:none;"><span style="font-family:FontAwesome;font-weight:normal;font-style:normal;line-height:1;"></span></i></a><span style="display:table;clear:both;"></span></div><hr style="box-sizing:content-box;height:0px;margin:15px 0px;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;border-right-color:initial;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);"/>

    <div style="position:relative;"><a name="comments" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;position:absolute;top:-65px;"></a></div>
							</div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 