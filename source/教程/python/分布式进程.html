<html>
<head>
  <title>分布式进程</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1974"/>
<h1>分布式进程</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/9/3 21:20</i></td></tr>
</table>
</div>
<br/>

<div><span>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="font:14px/20px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-size-adjust:100%;background:rgb(255, 255, 255);color:rgb(68, 68, 68);"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;color:rgb(102, 102, 102);background-color:rgb(255, 255, 255);"><div><div style="box-sizing:border-box;"><div style="list-style:none;"><div style="box-sizing:border-box;"><div><div><div><div><p style="margin:0px 0px 15px;">在Thread和Process中，应当优选Process，因为Process更稳定，而且，Process可以分布到多台机器上，而Thread最多只能分布到同一台机器的多个CPU上。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">Python的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">multiprocessing</code>模块不但支持多进程，其中<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">managers</code>子模块还支持把多进程分布到多台机器上。一个服务进程可以作为调度者，将任务分布到其他多个进程中，依靠网络通信。由于<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">managers</code>模块封装很好，不必了解网络通信的细节，就可以很容易地编写分布式多进程程序。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">举个例子：如果我们已经有一个通过<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>通信的多进程程序在同一台机器上运行，现在，由于处理任务的进程任务繁重，希望把发送任务的进程和处理任务的进程分布到两台机器上。怎么用分布式进程实现？</p>
<p style="margin:0px 0px 15px;margin-top:15px;">原有的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>可以继续使用，但是，通过<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">managers</code>模块把<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>通过网络暴露出去，就可以让其他机器的进程访问<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>了。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">我们先看服务进程，服务进程负责启动<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>，把<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>注册到网络上，然后往<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>里面写入任务：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 153, 136);font-style:italic;"># task_master.py</span>

<span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> random, time, queue
<span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> multiprocessing.managers <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> BaseManager

<span style="color:rgb(153, 153, 136);font-style:italic;"># 发送任务的队列:</span>
task_queue = queue.Queue()
<span style="color:rgb(153, 153, 136);font-style:italic;"># 接收结果的队列:</span>
result_queue = queue.Queue()

<span style="color:rgb(153, 153, 136);font-style:italic;"># 从BaseManager继承的QueueManager:</span>
<span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">QueueManager</span><span>(BaseManager)</span>:</span>
    <span style="color:rgb(51, 51, 51);font-weight:bold;">pass</span>

<span style="color:rgb(153, 153, 136);font-style:italic;"># 把两个Queue都注册到网络上, callable参数关联了Queue对象:</span>
QueueManager.register(<span style="color:rgb(221, 17, 68);">'get_task_queue'</span>, callable=<span style="color:rgb(51, 51, 51);font-weight:bold;">lambda</span>: task_queue)
QueueManager.register(<span style="color:rgb(221, 17, 68);">'get_result_queue'</span>, callable=<span style="color:rgb(51, 51, 51);font-weight:bold;">lambda</span>: result_queue)
<span style="color:rgb(153, 153, 136);font-style:italic;"># 绑定端口5000, 设置验证码'abc':</span>
manager = QueueManager(address=(<span style="color:rgb(221, 17, 68);">''</span>, <span style="color:rgb(0, 153, 153);">5000</span>), authkey=<span style="color:rgb(221, 17, 68);">b'abc'</span>)
<span style="color:rgb(153, 153, 136);font-style:italic;"># 启动Queue:</span>
manager.start()
<span style="color:rgb(153, 153, 136);font-style:italic;"># 获得通过网络访问的Queue对象:</span>
task = manager.get_task_queue()
result = manager.get_result_queue()
<span style="color:rgb(153, 153, 136);font-style:italic;"># 放几个任务进去:</span>
<span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> i <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(<span style="color:rgb(0, 153, 153);">10</span>):
    n = random.randint(<span style="color:rgb(0, 153, 153);">0</span>, <span style="color:rgb(0, 153, 153);">10000</span>)
    print(<span style="color:rgb(221, 17, 68);">'Put task %d...'</span> % n)
    task.put(n)
<span style="color:rgb(153, 153, 136);font-style:italic;"># 从result队列读取结果:</span>
print(<span style="color:rgb(221, 17, 68);">'Try get results...'</span>)
<span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> i <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(<span style="color:rgb(0, 153, 153);">10</span>):
    r = result.get(timeout=<span style="color:rgb(0, 153, 153);">10</span>)
    print(<span style="color:rgb(221, 17, 68);">'Result: %s'</span> % r)
<span style="color:rgb(153, 153, 136);font-style:italic;"># 关闭:</span>
manager.shutdown()
print(<span style="color:rgb(221, 17, 68);">'master exit.'</span>)
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">请注意，当我们在一台机器上写多进程程序时，创建的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>可以直接拿来用，但是，在分布式多进程环境下，添加任务到<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>不可以直接对原始的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_queue</code>进行操作，那样就绕过了<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">QueueManager</code>的封装，必须通过<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">manager.get_task_queue()</code>获得的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>接口添加。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">然后，在另一台机器上启动任务进程（本机上启动也可以）：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 153, 136);font-style:italic;"># task_worker.py</span>

<span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> time, sys, queue
<span style="color:rgb(51, 51, 51);font-weight:bold;">from</span> multiprocessing.managers <span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> BaseManager

<span style="color:rgb(153, 153, 136);font-style:italic;"># 创建类似的QueueManager:</span>
<span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">QueueManager</span><span>(BaseManager)</span>:</span>
    <span style="color:rgb(51, 51, 51);font-weight:bold;">pass</span>

<span style="color:rgb(153, 153, 136);font-style:italic;"># 由于这个QueueManager只从网络上获取Queue，所以注册时只提供名字:</span>
QueueManager.register(<span style="color:rgb(221, 17, 68);">'get_task_queue'</span>)
QueueManager.register(<span style="color:rgb(221, 17, 68);">'get_result_queue'</span>)

<span style="color:rgb(153, 153, 136);font-style:italic;"># 连接到服务器，也就是运行task_master.py的机器:</span>
server_addr = <span style="color:rgb(221, 17, 68);">'127.0.0.1'</span>
print(<span style="color:rgb(221, 17, 68);">'Connect to server %s...'</span> % server_addr)
<span style="color:rgb(153, 153, 136);font-style:italic;"># 端口和验证码注意保持与task_master.py设置的完全一致:</span>
m = QueueManager(address=(server_addr, <span style="color:rgb(0, 153, 153);">5000</span>), authkey=<span style="color:rgb(221, 17, 68);">b'abc'</span>)
<span style="color:rgb(153, 153, 136);font-style:italic;"># 从网络连接:</span>
m.connect()
<span style="color:rgb(153, 153, 136);font-style:italic;"># 获取Queue的对象:</span>
task = m.get_task_queue()
result = m.get_result_queue()
<span style="color:rgb(153, 153, 136);font-style:italic;"># 从task队列取任务,并把结果写入result队列:</span>
<span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> i <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(<span style="color:rgb(0, 153, 153);">10</span>):
    <span style="color:rgb(51, 51, 51);font-weight:bold;">try</span>:
        n = task.get(timeout=<span style="color:rgb(0, 153, 153);">1</span>)
        print(<span style="color:rgb(221, 17, 68);">'run task %d * %d...'</span> % (n, n))
        r = <span style="color:rgb(221, 17, 68);">'%d * %d = %d'</span> % (n, n, n*n)
        time.sleep(<span style="color:rgb(0, 153, 153);">1</span>)
        result.put(r)
    <span style="color:rgb(51, 51, 51);font-weight:bold;">except</span> Queue.Empty:
        print(<span style="color:rgb(221, 17, 68);">'task queue is empty.'</span>)
<span style="color:rgb(153, 153, 136);font-style:italic;"># 处理结束:</span>
print(<span style="color:rgb(221, 17, 68);">'worker exit.'</span>)
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">任务进程要通过网络连接到服务进程，所以要指定服务进程的IP。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">现在，可以试试分布式进程的工作效果了。先启动<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_master.py</code>服务进程：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(0, 128, 128);">$ </span>python3 task_master.py 
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">3411</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">1605</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">1398</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">4729</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">5300</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">7471</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">68</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">4219</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">339</span>...
<span style="color:rgb(0, 153, 153);">Put</span> task <span style="color:rgb(0, 153, 153);">7866</span>...
<span style="color:rgb(0, 153, 153);">Try</span> get results...
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_master.py</code>进程发送完任务后，开始等待<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">result</code>队列的结果。现在启动<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_worker.py</code>进程：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(0, 128, 128);">$ </span>python3 task_worker.py
<span style="color:rgb(0, 153, 153);">Connect</span> to server <span style="color:rgb(0, 153, 153);">127.0</span>.<span style="color:rgb(0, 153, 153);">0</span>.<span style="color:rgb(0, 153, 153);">1</span>...
run task <span style="color:rgb(0, 153, 153);">3411</span> * <span style="color:rgb(0, 153, 153);">3411</span>...
run task <span style="color:rgb(0, 153, 153);">1605</span> * <span style="color:rgb(0, 153, 153);">1605</span>...
run task <span style="color:rgb(0, 153, 153);">1398</span> * <span style="color:rgb(0, 153, 153);">1398</span>...
run task <span style="color:rgb(0, 153, 153);">4729</span> * <span style="color:rgb(0, 153, 153);">4729</span>...
run task <span style="color:rgb(0, 153, 153);">5300</span> * <span style="color:rgb(0, 153, 153);">5300</span>...
run task <span style="color:rgb(0, 153, 153);">7471</span> * <span style="color:rgb(0, 153, 153);">7471</span>...
run task <span style="color:rgb(0, 153, 153);">68</span> * <span style="color:rgb(0, 153, 153);">68</span>...
run task <span style="color:rgb(0, 153, 153);">4219</span> * <span style="color:rgb(0, 153, 153);">4219</span>...
run task <span style="color:rgb(0, 153, 153);">339</span> * <span style="color:rgb(0, 153, 153);">339</span>...
run task <span style="color:rgb(0, 153, 153);">7866</span> * <span style="color:rgb(0, 153, 153);">7866</span>...
worker exit.
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_worker.py</code>进程结束，在<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_master.py</code>进程中会继续打印出结果：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">Result: 3411 * 3411 = 11634921
Result: 1605 * 1605 = 2576025
Result: 1398 * 1398 = 1954404
Result: 4729 * 4729 = 22363441
Result: 5300 * 5300 = 28090000
Result: 7471 * 7471 = 55815841
Result: 68 * 68 = 4624
Result: 4219 * 4219 = 17799961
Result: 339 * 339 = 114921
Result: 7866 * 7866 = 61873956
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">这个简单的Master/Worker模型有什么用？其实这就是一个简单但真正的分布式计算，把代码稍加改造，启动多个worker，就可以把任务分布到几台甚至几十台机器上，比如把计算<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">n*n</code>的代码换成发送邮件，就实现了邮件队列的异步发送。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">Queue对象存储在哪？注意到<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_worker.py</code>中根本没有创建Queue的代码，所以，Queue对象存储在<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_master.py</code>进程中：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:none;border-radius:3px;font-size:12px;line-height:12px;white-space:pre;background-color:transparent;"><code style="white-space:pre-wrap;font-family:&quot;Courier New&quot;, Consolas, monospace;">                                             │
┌─────────────────────────────────────────┐     ┌──────────────────────────────────────┐
│task_master.py                           │  │  │task_worker.py                        │
│                                         │     │                                      │
│  task = manager.get_task_queue()        │  │  │  task = manager.get_task_queue()     │
│  result = manager.get_result_queue()    │     │  result = manager.get_result_queue() │
│              │                          │  │  │              │                       │
│              │                          │     │              │                       │
│              ▼                          │  │  │              │                       │
│  ┌─────────────────────────────────┐    │     │              │                       │
│  │QueueManager                     │    │  │  │              │                       │
│  │ ┌────────────┐ ┌──────────────┐ │    │     │              │                       │
│  │ │ task_queue │ │ result_queue │ │&lt;───┼──┼──┼──────────────┘                       │
│  │ └────────────┘ └──────────────┘ │    │     │                                      │
│  └─────────────────────────────────┘    │  │  │                                      │
└─────────────────────────────────────────┘     └──────────────────────────────────────┘
                                             │

                                          Network
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">而<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>之所以能通过网络访问，就是通过<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">QueueManager</code>实现的。由于<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">QueueManager</code>管理的不止一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>，所以，要给每个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Queue</code>的网络调用接口起个名字，比如<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">get_task_queue</code>。</p>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">authkey</code>有什么用？这是为了保证两台机器正常通信，不被其他机器恶意干扰。如果<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_worker.py</code>的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">authkey</code>和<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">task_master.py</code>的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">authkey</code>不一致，肯定连接不上。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">小结</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">Python的分布式进程接口简单，封装良好，适合需要把繁重任务分布到多台机器的环境下。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">注意Queue的作用是用来传递任务和接收结果，每个任务的描述数据量要尽量小。比如发送一个处理日志文件的任务，就不要发送几百兆的日志文件本身，而是发送日志文件存放的完整路径，由Worker进程再去共享的磁盘上读取文件。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">参考源码</h3>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/multitask/task_master.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">task_master.py</a></p>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/multitask/task_worker.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">task_worker.py</a></p>
</div></div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 