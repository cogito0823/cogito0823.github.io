<html>
<head>
  <title>列表生成式</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1797"/>
<h1>列表生成式</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/9/3 2:55</i></td></tr>
</table>
</div>
<br/>

<div><span>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="font:14px/20px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-size-adjust:100%;background:rgb(255, 255, 255);color:rgb(68, 68, 68);"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;color:rgb(102, 102, 102);background-color:rgb(255, 255, 255);"><div><div style="box-sizing:border-box;"><div style="list-style:none;"><div style="box-sizing:border-box;"><div><div><div><div><p style="margin:0px 0px 15px;">列表生成式即List Comprehensions，是Python内置的非常简单却强大的可以用来创建list的生成式。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">举个例子，要生成list <code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code>可以用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">list(range(1, 11))</code>：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">&gt;&gt;&gt; <span style="color:rgb(0, 0, 128);font-weight:normal;">list</span>(<span style="color:rgb(0, 0, 128);font-weight:normal;">range</span>(1, 11))
<span>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">但如果要生成<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">[1x1, 2x2, 3x3, ..., 10x10]</code>怎么做？方法一是循环：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>L = []
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> x <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">11</span>):
<span style="color:rgb(153, 0, 115);">... </span>   L.append(x * x)
...
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>L
[<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">4</span>, <span style="color:rgb(0, 153, 153);">9</span>, <span style="color:rgb(0, 153, 153);">16</span>, <span style="color:rgb(0, 153, 153);">25</span>, <span style="color:rgb(0, 153, 153);">36</span>, <span style="color:rgb(0, 153, 153);">49</span>, <span style="color:rgb(0, 153, 153);">64</span>, <span style="color:rgb(0, 153, 153);">81</span>, <span style="color:rgb(0, 153, 153);">100</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">但是循环太繁琐，而列表生成式则可以用一行语句代替循环生成上面的list：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>[x * x <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> x <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">11</span>)]
[<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">4</span>, <span style="color:rgb(0, 153, 153);">9</span>, <span style="color:rgb(0, 153, 153);">16</span>, <span style="color:rgb(0, 153, 153);">25</span>, <span style="color:rgb(0, 153, 153);">36</span>, <span style="color:rgb(0, 153, 153);">49</span>, <span style="color:rgb(0, 153, 153);">64</span>, <span style="color:rgb(0, 153, 153);">81</span>, <span style="color:rgb(0, 153, 153);">100</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">写列表生成式时，把要生成的元素<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">x * x</code>放到前面，后面跟<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">for</code>循环，就可以把list创建出来，十分有用，多写几次，很快就可以熟悉这种语法。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">for循环后面还可以加上if判断，这样我们就可以筛选出仅偶数的平方：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>[x * x <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> x <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">11</span>) <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> x % <span style="color:rgb(0, 153, 153);">2</span> == <span style="color:rgb(0, 153, 153);">0</span>]
[<span style="color:rgb(0, 153, 153);">4</span>, <span style="color:rgb(0, 153, 153);">16</span>, <span style="color:rgb(0, 153, 153);">36</span>, <span style="color:rgb(0, 153, 153);">64</span>, <span style="color:rgb(0, 153, 153);">100</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">还可以使用两层循环，可以生成全排列：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>[m + n <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> m <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> <span style="color:rgb(221, 17, 68);">'ABC'</span> <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> n <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> <span style="color:rgb(221, 17, 68);">'XYZ'</span>]
[<span style="color:rgb(221, 17, 68);">'AX'</span>, <span style="color:rgb(221, 17, 68);">'AY'</span>, <span style="color:rgb(221, 17, 68);">'AZ'</span>, <span style="color:rgb(221, 17, 68);">'BX'</span>, <span style="color:rgb(221, 17, 68);">'BY'</span>, <span style="color:rgb(221, 17, 68);">'BZ'</span>, <span style="color:rgb(221, 17, 68);">'CX'</span>, <span style="color:rgb(221, 17, 68);">'CY'</span>, <span style="color:rgb(221, 17, 68);">'CZ'</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">三层和三层以上的循环就很少用到了。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">运用列表生成式，可以写出非常简洁的代码。例如，列出当前目录下的所有文件和目录名，可以通过一行代码实现：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">import</span> os <span style="color:rgb(153, 153, 136);font-style:italic;"># 导入os模块，模块的概念后面讲到</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>[d <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> d <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> os.listdir(<span style="color:rgb(221, 17, 68);">'.'</span>)] <span style="color:rgb(153, 153, 136);font-style:italic;"># os.listdir可以列出文件和目录</span>
[<span style="color:rgb(221, 17, 68);">'.emacs.d'</span>, <span style="color:rgb(221, 17, 68);">'.ssh'</span>, <span style="color:rgb(221, 17, 68);">'.Trash'</span>, <span style="color:rgb(221, 17, 68);">'Adlm'</span>, <span style="color:rgb(221, 17, 68);">'Applications'</span>, <span style="color:rgb(221, 17, 68);">'Desktop'</span>, <span style="color:rgb(221, 17, 68);">'Documents'</span>, <span style="color:rgb(221, 17, 68);">'Downloads'</span>, <span style="color:rgb(221, 17, 68);">'Library'</span>, <span style="color:rgb(221, 17, 68);">'Movies'</span>, <span style="color:rgb(221, 17, 68);">'Music'</span>, <span style="color:rgb(221, 17, 68);">'Pictures'</span>, <span style="color:rgb(221, 17, 68);">'Public'</span>, <span style="color:rgb(221, 17, 68);">'VirtualBox VMs'</span>, <span style="color:rgb(221, 17, 68);">'Workspace'</span>, <span style="color:rgb(221, 17, 68);">'XCode'</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">for</code>循环其实可以同时使用两个甚至多个变量，比如<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">items()</code>可以同时迭代key和value：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>d = {<span style="color:rgb(221, 17, 68);">'x'</span>: <span style="color:rgb(221, 17, 68);">'A'</span>, <span style="color:rgb(221, 17, 68);">'y'</span>: <span style="color:rgb(221, 17, 68);">'B'</span>, <span style="color:rgb(221, 17, 68);">'z'</span>: <span style="color:rgb(221, 17, 68);">'C'</span> }
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> k, v <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> d.items():
<span style="color:rgb(153, 0, 115);">... </span>    print(k, <span style="color:rgb(221, 17, 68);">'='</span>, v)
...
y = B
x = A
z = C
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">因此，列表生成式也可以使用两个变量来生成list：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>d = {<span style="color:rgb(221, 17, 68);">'x'</span>: <span style="color:rgb(221, 17, 68);">'A'</span>, <span style="color:rgb(221, 17, 68);">'y'</span>: <span style="color:rgb(221, 17, 68);">'B'</span>, <span style="color:rgb(221, 17, 68);">'z'</span>: <span style="color:rgb(221, 17, 68);">'C'</span> }
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>[k + <span style="color:rgb(221, 17, 68);">'='</span> + v <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> k, v <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> d.items()]
[<span style="color:rgb(221, 17, 68);">'y=B'</span>, <span style="color:rgb(221, 17, 68);">'x=A'</span>, <span style="color:rgb(221, 17, 68);">'z=C'</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">最后把一个list中所有的字符串变成小写：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>L = [<span style="color:rgb(221, 17, 68);">'Hello'</span>, <span style="color:rgb(221, 17, 68);">'World'</span>, <span style="color:rgb(221, 17, 68);">'IBM'</span>, <span style="color:rgb(221, 17, 68);">'Apple'</span>]
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>[s.lower() <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> s <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> L]
[<span style="color:rgb(221, 17, 68);">'hello'</span>, <span style="color:rgb(221, 17, 68);">'world'</span>, <span style="color:rgb(221, 17, 68);">'ibm'</span>, <span style="color:rgb(221, 17, 68);">'apple'</span>]
</code></pre>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">练习</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">如果list中既包含字符串，又包含整数，由于非字符串类型没有<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">lower()</code>方法，所以列表生成式会报错：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">&gt;&gt;&gt; L = ['Hello', 'World', 18, 'Apple', None]
&gt;&gt;&gt; [s.lower() for s in L]
Traceback (most recent call last):
  File &quot;<span style="color:rgb(0, 0, 128);font-weight:normal;">&lt;<span style="color:rgb(0, 0, 128);font-weight:normal;">stdin</span>&gt;</span>&quot;, line 1, in <span style="color:rgb(0, 0, 128);font-weight:normal;">&lt;<span style="color:rgb(0, 0, 128);font-weight:normal;">module</span>&gt;</span>
  File &quot;<span style="color:rgb(0, 0, 128);font-weight:normal;">&lt;<span style="color:rgb(0, 0, 128);font-weight:normal;">stdin</span>&gt;</span>&quot;, line 1, in <span style="color:rgb(0, 0, 128);font-weight:normal;">&lt;<span style="color:rgb(0, 0, 128);font-weight:normal;">listcomp</span>&gt;</span>
AttributeError: 'int' object has no attribute 'lower'
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">使用内建的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">isinstance</code>函数可以判断一个变量是不是字符串：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>x = <span style="color:rgb(221, 17, 68);">'abc'</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>y = <span style="color:rgb(0, 153, 153);">123</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>isinstance(x, str)
<span style="color:rgb(0, 134, 179);">True</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>isinstance(y, str)
<span style="color:rgb(0, 134, 179);">False</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">请修改列表生成式，通过添加<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">if</code>语句保证列表生成式能正确地执行：</p>
<div style="margin-top:15px;margin-bottom:15px;"><pre style="margin:0px 0px 15px;padding:6px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;font-size:14px;margin-bottom:0px;border-bottom:none;border-bottom-left-radius:0px;border-bottom-right-radius:0px;"># -*- coding: utf-8 -*-
L1 = ['Hello', 'World', 18, 'Apple', None]
</pre><pre style="margin:0px 0px 15px;margin-top:0;padding:6px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;font-size:14px;border-top:0;border-top-left-radius:0;border-top-right-radius:0;"># 测试:
print(L2)
if L2 == ['hello', 'world', 'apple']:
    print('测试通过!')
else:
    print('测试失败!')
</pre></div>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">小结</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">运用列表生成式，可以快速生成list，可以通过一个list推导出另一个list，而代码却十分简洁。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">参考源码</h3>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/advance/do_listcompr.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">do_listcompr.py</a></p>
</div></div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 