<html>
<head>
  <title>定制类</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1955"/>
<h1>定制类</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/9/3 3:03</i></td></tr>
</table>
</div>
<br/>

<div><span>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="font:14px/20px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-size-adjust:100%;background:rgb(255, 255, 255);color:rgb(68, 68, 68);"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;color:rgb(102, 102, 102);background-color:rgb(255, 255, 255);"><div><div style="box-sizing:border-box;"><div style="list-style:none;"><div style="box-sizing:border-box;"><div><div><div><div><p style="margin:0px 0px 15px;">看到类似<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__slots__</code>这种形如<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__xxx__</code>的变量或者函数名就要注意，这些在Python中是有特殊用途的。</p>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__slots__</code>我们已经知道怎么用了，<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__len__()</code>方法我们也知道是为了能让class作用于<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">len()</code>函数。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">除此之外，Python的class中还有许多这样有特殊用途的函数，可以帮助我们定制类。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">__str__</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">我们先定义一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Student</code>类，打印一个实例：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>
<span style="color:rgb(153, 0, 115);">... </span>    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self, name)</span>:</span>
<span style="color:rgb(153, 0, 115);">... </span>        self.name = name
...
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>print(Student(<span style="color:rgb(221, 17, 68);">'Michael'</span>))
&lt;__main__.Student object at <span style="color:rgb(0, 153, 153);">0x109afb190</span>&gt;
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">打印出一堆<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">&lt;__main__.Student object at 0x109afb190&gt;</code>，不好看。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">怎么才能打印得好看呢？只需要定义好<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__str__()</code>方法，返回一个好看的字符串就可以了：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>
<span style="color:rgb(153, 0, 115);">... </span>    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self, name)</span>:</span>
<span style="color:rgb(153, 0, 115);">... </span>        self.name = name
<span style="color:rgb(153, 0, 115);">... </span>    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__str__</span><span>(self)</span>:</span>
<span style="color:rgb(153, 0, 115);">... </span>        <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> <span style="color:rgb(221, 17, 68);">'Student object (name: %s)'</span> % self.name
...
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>print(Student(<span style="color:rgb(221, 17, 68);">'Michael'</span>))
Student object (name: Michael)
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">这样打印出来的实例，不但好看，而且容易看出实例内部重要的数据。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">但是细心的朋友会发现直接敲变量不用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">print</code>，打印出来的实例还是不好看：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">&gt;&gt;&gt; s = Student('Michael')
&gt;&gt;&gt; s
<span style="color:rgb(0, 0, 128);font-weight:normal;">&lt;<span style="color:rgb(0, 0, 128);font-weight:normal;">__main__.Student</span> <span style="color:rgb(0, 128, 128);">object</span> <span style="color:rgb(0, 128, 128);">at</span> <span style="color:rgb(0, 128, 128);">0x109afb310</span>&gt;</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">这是因为直接显示变量调用的不是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__str__()</code>，而是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__repr__()</code>，两者的区别是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__str__()</code>返回用户看到的字符串，而<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__repr__()</code>返回程序开发者看到的字符串，也就是说，<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__repr__()</code>是为调试服务的。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">解决办法是再定义一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__repr__()</code>。但是通常<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__str__()</code>和<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__repr__()</code>代码都是一样的，所以，有个偷懒的写法：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>
    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self, name)</span>:</span>
        self.name = name
    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__str__</span><span>(self)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> <span style="color:rgb(221, 17, 68);">'Student object (name=%s)'</span> % self.name
    __repr__ = __str__
</code></pre>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">__iter__</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">如果一个类想被用于<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">for ... in</code>循环，类似list或tuple那样，就必须实现一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__iter__()</code>方法，该方法返回一个迭代对象，然后，Python的for循环就会不断调用该迭代对象的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__next__()</code>方法拿到循环的下一个值，直到遇到<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">StopIteration</code>错误时退出循环。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">我们以斐波那契数列为例，写一个Fib类，可以作用于for循环：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Fib</span><span>(object)</span>:</span>
    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self)</span>:</span>
        self.a, self.b = <span style="color:rgb(0, 153, 153);">0</span>, <span style="color:rgb(0, 153, 153);">1</span> <span style="color:rgb(153, 153, 136);font-style:italic;"># 初始化两个计数器a，b</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__iter__</span><span>(self)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> self <span style="color:rgb(153, 153, 136);font-style:italic;"># 实例本身就是迭代对象，故返回自己</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__next__</span><span>(self)</span>:</span>
        self.a, self.b = self.b, self.a + self.b <span style="color:rgb(153, 153, 136);font-style:italic;"># 计算下一个值</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> self.a &gt; <span style="color:rgb(0, 153, 153);">100000</span>: <span style="color:rgb(153, 153, 136);font-style:italic;"># 退出循环的条件</span>
            <span style="color:rgb(51, 51, 51);font-weight:bold;">raise</span> StopIteration()
        <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> self.a <span style="color:rgb(153, 153, 136);font-style:italic;"># 返回下一个值</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">现在，试试把Fib实例作用于for循环：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span><span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> n <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> Fib():
<span style="color:rgb(153, 0, 115);">... </span>    print(n)
...
<span style="color:rgb(0, 153, 153);">1</span>
<span style="color:rgb(0, 153, 153);">1</span>
<span style="color:rgb(0, 153, 153);">2</span>
<span style="color:rgb(0, 153, 153);">3</span>
<span style="color:rgb(0, 153, 153);">5</span>
...
<span style="color:rgb(0, 153, 153);">46368</span>
<span style="color:rgb(0, 153, 153);">75025</span>
</code></pre>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">__getitem__</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">Fib实例虽然能作用于for循环，看起来和list有点像，但是，把它当成list来使用还是不行，比如，取第5个元素：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">&gt;&gt;&gt; Fib()[5]
Traceback (most recent call last):
  File &quot;<span style="color:rgb(0, 0, 128);font-weight:normal;">&lt;<span style="color:rgb(0, 0, 128);font-weight:normal;">stdin</span>&gt;</span>&quot;, line 1, in <span style="color:rgb(0, 0, 128);font-weight:normal;">&lt;<span style="color:rgb(0, 0, 128);font-weight:normal;">module</span>&gt;</span>
TypeError: 'Fib' object does not support indexing
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">要表现得像list那样按照下标取出元素，需要实现<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getitem__()</code>方法：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Fib</span><span>(object)</span>:</span>
    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__getitem__</span><span>(self, n)</span>:</span>
        a, b = <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">1</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> x <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(n):
            a, b = b, a + b
        <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> a
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">现在，就可以按下标访问数列的任意一项了：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f = Fib()
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[<span style="color:rgb(0, 153, 153);">0</span>]
<span style="color:rgb(0, 153, 153);">1</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[<span style="color:rgb(0, 153, 153);">1</span>]
<span style="color:rgb(0, 153, 153);">1</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[<span style="color:rgb(0, 153, 153);">2</span>]
<span style="color:rgb(0, 153, 153);">2</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[<span style="color:rgb(0, 153, 153);">3</span>]
<span style="color:rgb(0, 153, 153);">3</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[<span style="color:rgb(0, 153, 153);">10</span>]
<span style="color:rgb(0, 153, 153);">89</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[<span style="color:rgb(0, 153, 153);">100</span>]
<span style="color:rgb(0, 153, 153);">573147844013817084101</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">但是list有个神奇的切片方法：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">&gt;&gt;&gt; <span style="color:rgb(0, 0, 128);font-weight:normal;">list</span>(<span style="color:rgb(0, 0, 128);font-weight:normal;">range</span>(100))<span>[5:10]</span>
<span>[5, 6, 7, 8, 9]</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">对于Fib却报错。原因是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getitem__()</code>传入的参数可能是一个int，也可能是一个切片对象<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">slice</code>，所以要做判断：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Fib</span><span>(object)</span>:</span>
    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__getitem__</span><span>(self, n)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> isinstance(n, int): <span style="color:rgb(153, 153, 136);font-style:italic;"># n是索引</span>
            a, b = <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">1</span>
            <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> x <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(n):
                a, b = b, a + b
            <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> a
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> isinstance(n, slice): <span style="color:rgb(153, 153, 136);font-style:italic;"># n是切片</span>
            start = n.start
            stop = n.stop
            <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> start <span style="color:rgb(51, 51, 51);font-weight:bold;">is</span> <span style="color:rgb(0, 134, 179);">None</span>:
                start = <span style="color:rgb(0, 153, 153);">0</span>
            a, b = <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">1</span>
            L = []
            <span style="color:rgb(51, 51, 51);font-weight:bold;">for</span> x <span style="color:rgb(51, 51, 51);font-weight:bold;">in</span> range(stop):
                <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> x &gt;= start:
                    L.append(a)
                a, b = b, a + b
            <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> L
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">现在试试Fib的切片：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f = Fib()
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[<span style="color:rgb(0, 153, 153);">0</span>:<span style="color:rgb(0, 153, 153);">5</span>]
[<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">2</span>, <span style="color:rgb(0, 153, 153);">3</span>, <span style="color:rgb(0, 153, 153);">5</span>]
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>f[:<span style="color:rgb(0, 153, 153);">10</span>]
[<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">2</span>, <span style="color:rgb(0, 153, 153);">3</span>, <span style="color:rgb(0, 153, 153);">5</span>, <span style="color:rgb(0, 153, 153);">8</span>, <span style="color:rgb(0, 153, 153);">13</span>, <span style="color:rgb(0, 153, 153);">21</span>, <span style="color:rgb(0, 153, 153);">34</span>, <span style="color:rgb(0, 153, 153);">55</span>]
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">但是没有对step参数作处理：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">&gt;&gt;&gt; <span style="color:rgb(0, 0, 128);font-weight:normal;">f</span><span>[:10:2]</span>
<span>[1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">也没有对负数作处理，所以，要正确实现一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getitem__()</code>还是有很多工作要做的。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">此外，如果把对象看成<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">dict</code>，<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getitem__()</code>的参数也可能是一个可以作key的object，例如<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">str</code>。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">与之对应的是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__setitem__()</code>方法，把对象视作list或dict来对集合赋值。最后，还有一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__delitem__()</code>方法，用于删除某个元素。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">总之，通过上面的方法，我们自己定义的类表现得和Python自带的list、tuple、dict没什么区别，这完全归功于动态语言的“鸭子类型”，不需要强制继承某个接口。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">__getattr__</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">正常情况下，当我们调用类的方法或属性时，如果不存在，就会报错。比如定义<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Student</code>类：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>
    
    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self)</span>:</span>
        self.name = <span style="color:rgb(221, 17, 68);">'Michael'</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">调用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">name</code>属性，没问题，但是，调用不存在的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">score</code>属性，就有问题了：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>s = Student()
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>print(s.name)
Michael
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>print(s.score)
Traceback (most recent call last):
  ...
AttributeError: <span style="color:rgb(221, 17, 68);">'Student'</span> object has no attribute <span style="color:rgb(221, 17, 68);">'score'</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">错误信息很清楚地告诉我们，没有找到<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">score</code>这个attribute。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">要避免这个错误，除了可以加上一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">score</code>属性外，Python还有另一个机制，那就是写一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getattr__()</code>方法，动态返回一个属性。修改如下：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self)</span>:</span>
        self.name = <span style="color:rgb(221, 17, 68);">'Michael'</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__getattr__</span><span>(self, attr)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> attr==<span style="color:rgb(221, 17, 68);">'score'</span>:
            <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> <span style="color:rgb(0, 153, 153);">99</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">当调用不存在的属性时，比如<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">score</code>，Python解释器会试图调用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getattr__(self, 'score')</code>来尝试获得属性，这样，我们就有机会返回<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">score</code>的值：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>s = Student()
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>s.name
<span style="color:rgb(221, 17, 68);">'Michael'</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>s.score
<span style="color:rgb(0, 153, 153);">99</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">返回函数也是完全可以的：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__getattr__</span><span>(self, attr)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> attr==<span style="color:rgb(221, 17, 68);">'age'</span>:
            <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> <span style="color:rgb(51, 51, 51);font-weight:bold;">lambda</span>: <span style="color:rgb(0, 153, 153);">25</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">只是调用方式要变为：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>s.age()
<span style="color:rgb(0, 153, 153);">25</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">注意，只有在没有找到属性的情况下，才调用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getattr__</code>，已有的属性，比如<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">name</code>，不会在<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getattr__</code>中查找。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">此外，注意到任意调用如<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">s.abc</code>都会返回<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">None</code>，这是因为我们定义的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getattr__</code>默认返回就是<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">None</code>。要让class只响应特定的几个属性，我们就要按照约定，抛出<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">AttributeError</code>的错误：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__getattr__</span><span>(self, attr)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">if</span> attr==<span style="color:rgb(221, 17, 68);">'age'</span>:
            <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> <span style="color:rgb(51, 51, 51);font-weight:bold;">lambda</span>: <span style="color:rgb(0, 153, 153);">25</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">raise</span> AttributeError(<span style="color:rgb(221, 17, 68);">'\'Student\' object has no attribute \'%s\''</span> % attr)
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">这实际上可以把一个类的所有属性和方法调用全部动态化处理了，不需要任何特殊手段。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">这种完全动态调用的特性有什么实际作用呢？作用就是，可以针对完全动态的情况作调用。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">举个例子：</p>
<p style="margin:0px 0px 15px;margin-top:15px;">现在很多网站都搞REST API，比如新浪微博、豆瓣啥的，调用API的URL类似：</p>
<ul style="margin:0px 0px 15px;margin-top:15px;padding-left:30px;">
<li>http://api.server/user/friends</li>
<li>http://api.server/user/timeline/list</li>
</ul>
<p style="margin:0px 0px 15px;margin-top:15px;">如果要写SDK，给每个URL对应的API都写一个方法，那得累死，而且，API一旦改动，SDK也要改。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">利用完全动态的<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__getattr__</code>，我们可以写出一个链式调用：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Chain</span><span>(object)</span>:</span>

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self, path=<span style="color:rgb(221, 17, 68);">''</span>)</span>:</span>
        self._path = path

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__getattr__</span><span>(self, path)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> Chain(<span style="color:rgb(221, 17, 68);">'%s/%s'</span> % (self._path, path))

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__str__</span><span>(self)</span>:</span>
        <span style="color:rgb(51, 51, 51);font-weight:bold;">return</span> self._path

    __repr__ = __str__
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">试试：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">&gt;&gt;&gt; Chain().status.user.timeline.<span style="color:rgb(51, 51, 51);font-weight:bold;">list</span>
<span style="color:rgb(221, 17, 68);">'/status/user/timeline/list'</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">这样，无论API怎么变，SDK都可以根据URL实现完全动态的调用，而且，不随API的增加而改变！</p>
<p style="margin:0px 0px 15px;margin-top:15px;">还有些REST API会把参数放到URL中，比如GitHub的API：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(0, 153, 153);">GET</span> /users/<span style="color:rgb(153, 0, 115);">:user/repos</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">调用时，需要把<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">:user</code>替换为实际用户名。如果我们能写出这样的链式调用：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;">Chain().users('michael').repos
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">就可以非常方便地调用API了。有兴趣的童鞋可以试试写出来。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">__call__</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">一个对象实例可以有自己的属性和方法，当我们调用实例方法时，我们用<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">instance.method()</code>来调用。能不能直接在实例本身上调用呢？在Python中，答案是肯定的。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">任何类，只需要定义一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__call__()</code>方法，就可以直接对实例进行调用。请看示例：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(68, 85, 136);font-weight:bold;"><span style="color:rgb(51, 51, 51);font-weight:bold;">class</span> <span style="color:rgb(68, 85, 136);font-weight:bold;">Student</span><span>(object)</span>:</span>
    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__init__</span><span>(self, name)</span>:</span>
        self.name = name

    <span><span style="color:rgb(51, 51, 51);font-weight:bold;">def</span> <span style="color:rgb(153, 0, 0);font-weight:bold;">__call__</span><span>(self)</span>:</span>
        print(<span style="color:rgb(221, 17, 68);">'My name is %s.'</span> % self.name)
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">调用方式如下：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>s = Student(<span style="color:rgb(221, 17, 68);">'Michael'</span>)
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>s() <span style="color:rgb(153, 153, 136);font-style:italic;"># self参数不要传入</span>
My name <span style="color:rgb(51, 51, 51);font-weight:bold;">is</span> Michael.
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;"><code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__call__()</code>还可以定义参数。对实例进行直接调用就好比对一个函数进行调用一样，所以你完全可以把对象看成函数，把函数看成对象，因为这两者之间本来就没啥根本的区别。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">如果你把对象看成函数，那么函数本身其实也可以在运行期动态创建出来，因为类的实例都是运行期创建出来的，这么一来，我们就模糊了对象和函数的界限。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">那么，怎么判断一个变量是对象还是函数呢？其实，更多的时候，我们需要判断一个对象是否能被调用，能被调用的对象就是一个<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">Callable</code>对象，比如函数和我们上面定义的带有<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">__call__()</code>的类实例：</p>
<pre style="margin:0px 0px 15px;margin-top:15px;padding:10px;background:rgb(250, 250, 250);font:12px/18px Consolas, monospace, serif;color:rgb(68, 68, 68);tab-size:4;overflow:auto;border:1px solid rgb(221, 221, 221);border-radius:3px;"><code style="white-space:pre-wrap;"><span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>callable(Student())
<span style="color:rgb(0, 134, 179);">True</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>callable(max)
<span style="color:rgb(0, 134, 179);">True</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>callable([<span style="color:rgb(0, 153, 153);">1</span>, <span style="color:rgb(0, 153, 153);">2</span>, <span style="color:rgb(0, 153, 153);">3</span>])
<span style="color:rgb(0, 134, 179);">False</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>callable(<span style="color:rgb(0, 134, 179);">None</span>)
<span style="color:rgb(0, 134, 179);">False</span>
<span style="color:rgb(153, 0, 115);">&gt;&gt;&gt; </span>callable(<span style="color:rgb(221, 17, 68);">'str'</span>)
<span style="color:rgb(0, 134, 179);">False</span>
</code></pre>
<p style="margin:0px 0px 15px;margin-top:15px;">通过<code style="font-size:12px;font-family:Consolas, monospace, serif;color:rgb(221, 0, 85);padding:0px 4px;border:1px solid rgb(221, 221, 221);border-radius:3px;background:rgb(250, 250, 250);white-space:normal;">callable()</code>函数，我们就可以判断一个对象是否是“可调用”对象。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">小结</h3>
<p style="margin:0px 0px 15px;margin-top:15px;">Python的class允许定义许多定制方法，可以让我们非常方便地生成特定的类。</p>
<p style="margin:0px 0px 15px;margin-top:15px;">本节介绍的是最常用的几个定制方法，还有很多可定制的方法，请参考<a href="http://docs.python.org/3/reference/datamodel.html#special-method-names" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">Python的官方文档</a>。</p>
<h3 style="margin:0px 0px 15px;font-family:&quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight:normal;color:rgb(68, 68, 68);text-transform:none;margin-top:25px;font-size:18px;line-height:24px;">参考源码</h3>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/oop_advance/special_str.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">special_str.py</a></p>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/oop_advance/special_iter.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">special_iter.py</a></p>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/oop_advance/special_getitem.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">special_getitem.py</a></p>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/oop_advance/special_getattr.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">special_getattr.py</a></p>
<p style="margin:0px 0px 15px;margin-top:15px;"><a href="https://github.com/michaelliao/learn-python3/blob/master/samples/oop_advance/special_call.py" style="background:transparent;color:rgb(5, 147, 211);text-decoration:none;cursor:pointer;" target="_blank">special_call.py</a></p>
</div></div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 